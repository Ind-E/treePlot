---
title: "How to make an R package"
author: "Indi Esneault"
format:
  html:
    embed-resources: true
---

#### Step 0: Install needed tools
```{r install_packages, eval=FALSE}
install.packages("devtools")
install.packages("roxygen2")
```

```{r load_packages, message=FALSE, warning=FALSE}
library(devtools)
library(roxygen2)
```

#### Step 1: Setting up the package directory
Create a folder to store your package. The name of the folder should be the name of your package. I called my package `Simple_Geometry_Package`. Inside the package folder, create a subfolder called `R`. This is where you will store your .R script files. Inside the R folder, create a new .R file, I named mine `circles.R`. This is where you will write your functions. 

At this point, your directory structure should look something like this:
```
Simple_Geometry_Package
└───R
│   └───circles.R
```

#### Step 2: Writing a function
The next step is to write functions that will be included in your package. For this demonstration, I'll write simple functions to calculate the area and circumference of a cirlce.

Here is what the `circles.R` file might look like for our Geometry package:
```{r circles.R}
c_area <- function(radius) {
  return(pi * radius^2)
}

c_circumference <- function(radius) {
  return(2 * pi * radius)
}
```

#### Step 3: Creating a DESCRIPTION file
The next step is to create a new file in your package directory called DESCRIPTION. This file will contain metadata about your package, such as its title, version, and author. 

Your directory structure should now look like this:
```
Simple_Geometry_Package
└───R
│   └───circles.R
│   DESCRIPTION
```

Then, open the DESCRIPTION file and add the following information:
```
Package: SimpleGeometryPackage
Type: Package
Title: Simple Geometry
Version: 0.0.1.0
Encoding:UTF - 8

```
The` Package` field should contain only letters, numbers and dots. Make sure to leave a blank line at the end of the file.
You can include more information about the package such as author, maintainer, or description, but this is all we need for now.

#### Step 4: Adding Documentation
At this point, we technically created a package. However, it is best practice to add documentation to your functions. This will make it easier for others to understand how to use your package. Comments denoted with `#'` will be used by roxygen2 to automatically generate documentation. We start with a title, then a description of the function, then a list of parameters, and finally an example of how to use the function.

Here is an example of what the circles.R file might look like with documentation:
```{r add_documentation}
#' Area of a circle
#'
#' This function calculates the area of a circle given its radius.
#' @param radius The radius of the circle.
#' @return The area of the circle.
#' @examples
#' c_area(5)
#' @export
c_area <- function(radius) {
  return(pi * radius^2)
}

#' Circumference of a circle
#' 
#' This function calculates the circumference of a circle given its radius.
#' @param radius The radius of the circle.
#' @return The circumference of the circle.
#' @examples
#' c_circumference(5)
#' @export
c_circumference <- function(radius) {
  return(2 * pi * radius)
}
```

Then, we can run the `roxygenise()` command to generate .Rd files that will contain the documentation for each function. 
Make sure you are in the main package directory when you run this command. If you aren't, you can change directories by running `setwd("path/to/your/package")`. 
```{r roxygenise, eval=FALSE}
roxygenise()
```

You may have noticed that a NAMESPACE file was also created when we ran the `roxygenise()` function. This file is used to specify which functions are exported from the package. If you open the NAMESPACE file it should look something like this:
```{r, eval=FALSE}
# Generated by roxygen2: do not edit by hand

export(c_area)
export(c_circumference)
```

And here is what the directory structure should look like after running the `roxygenise()` command:
```
Simple_Geometry_Package
└───R
│   └───circles.R
└───MAN
│   └───c_area.Rd
│   └───c_circumference.Rd
│   DESCRIPTION
│   NAMESPACE
```

#### Step 5: Uploading to and installing from GitHub
If we want anyone else to be able to use our package, we need to upload it somewhere. Well-known packages are typically hosted on the CRAN repository, but the process for getting a package on CRAN is quite involved and has strict requirements. A simpler alternative is to host your package on GitHub. To do so, you need to initialize a git repository in your package directory and push it to GitHub. If you are inexperienced with using git, you can follow the steps below.

1. Create a new repository on GitHub. To do so, go to the GitHub website and click the "New" button in the top right corner. Then, fill in the repository name and click "Create repository".
2. Open up the terminal and navigate to your package directory using the `cd` command.
3. Run `git init` to initialize a new git repository. 
4. Run `git remote add origin https://link/to/your/repository` to add the GitHub repository as a remote.
5. Run `git add .` to stage all of the files in the directory. 
6. Run `git commit -m "your commit message here"` to commit the files. If you are working from posit cloud or this is your first time using git, you may need to run `git config --global user.email` and `git config --global user.name` to set your email and username.
7. a) If you are working from your local machine, run `git push -u origin master` to push the files to GitHub.
   b) If you are working from posit cloud, you first need to generate a personal acces token. Follow the steps <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens#creating-a-personal-access-token-classic" target="_blank">here</a> to do so. Make sure to include the repo scope when generating your token. Then, run `git push --set-upstream origin master` and enter your username and personal access token when prompted. If you want to avoid entering your username and personal access token every time you push, you can run `git config --global credential.helper store` to store your credentials.

Now that you've uploaded to GitHub, anyone can install your package by running the following command in R:
```{r install_github, message=FALSE, warning=FALSE}
library(devtools) # Make sure that the devtools library is loaded
install_github("Ind-E/SimpleGeometryPackage")
```

Now that your package is installed, you can use it like any other package. Here is an example of how you might use the functions in the Simple Geometry Package:
```{r use_package, message=FALSE, warning=FALSE}
library(SimpleGeometryPackage)
c_area(5)
c_circumference(5)
```

